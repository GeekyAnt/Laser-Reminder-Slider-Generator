<!DOCTYPE html>
<!--
    Laser Reminder Slider Generator
    Web-based parametric designer for laser-cut reminder boards
    
    Copyright (c) 2025 Alex
    
    This project is licensed under the MIT License.
    
    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:
    
    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.
    
    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.
    
    Repository: https://github.com/GeekyAnt/laser-reminder-slider-generator
    
    Built with Three.js (https://threejs.org/)
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reminder Board Designer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&family=Lato:wght@400;700&family=Montserrat:wght@400;700&family=Oswald:wght@400;700&family=Raleway:wght@400;700&family=Playfair+Display:wght@400;700&family=Bebas+Neue&family=Pacifico&family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet" onerror="this.onerror=null;">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        .sidebar {
            width: 350px;
            background: white;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
            font-size: 14px;
        }
        
        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        
        input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .export-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }
        
        .export-section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
        }
        
        .export-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        button {
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        .viewer {
            flex: 1;
            position: relative;
            background: #e0e0e0;
        }
        
        #canvas-container {
            width: 100%;
            height: 100%;
        }
        
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #1976d2;
        }
        
        .divider {
            height: 1px;
            background: #eee;
            margin: 25px 0;
        }
        
        .controls-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h1>üéØ Reminder Board Designer</h1>
        
        <div class="info">
            Adjust the parameters below to customize your reminder board. The 3D preview updates in real-time!
        </div>

        <div class="control-group" style="background: #f9f9f9; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
            <label style="font-weight: 600; margin-bottom: 10px; display: block;">Layer Visibility</label>
            <div style="display: flex; flex-direction: column; gap: 8px;">
                <label style="display: flex; align-items: center; cursor: pointer; font-weight: normal;">
                    <input type="checkbox" id="show_layer1" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                    <span>Show Layer 1 (Base)</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer; font-weight: normal;">
                    <input type="checkbox" id="show_layer2" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                    <span>Show Layer 2 (Slots)</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer; font-weight: normal;">
                    <input type="checkbox" id="show_layer3" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                    <span>Show Layer 3 (Top)</span>
                </label>
            </div>
        </div>

        <div class="control-group">
            <label for="material_thickness">Material Thickness (mm)</label>
            <input type="range" id="material_thickness" min="1" max="10" step="0.5" value="3">
            <input type="number" id="material_thickness_num" min="1" max="10" step="0.5" value="3">
        </div>

        <div class="control-group">
            <label for="board_width">Board Width (mm)</label>
            <input type="range" id="board_width" min="80" max="200" step="1" value="127">
            <input type="number" id="board_width_num" min="80" max="200" step="1" value="127">
        </div>

        <div class="divider"></div>

        <div class="control-group">
            <label for="header_height">Header Height (mm)</label>
            <input type="range" id="header_height" min="20" max="50" step="1" value="30">
            <input type="number" id="header_height_num" min="20" max="50" step="1" value="30">
        </div>

        <div class="control-group">
            <label for="header_text">Header Text</label>
            <input type="text" id="header_text" placeholder="Enter header text" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>

        <div class="control-group">
            <label for="font_family_header">Header Font</label>
            <select id="font_family_header" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                <optgroup label="Sans-Serif (Web Safe)">
                    <option value="Arial">Arial</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Verdana">Verdana</option>
                    <option value="Tahoma">Tahoma</option>
                    <option value="Trebuchet MS">Trebuchet MS</option>
                    <option value="Century Gothic">Century Gothic</option>
                    <option value="Franklin Gothic Medium">Franklin Gothic Medium</option>
                </optgroup>
                <optgroup label="Serif (Web Safe)">
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Palatino Linotype">Palatino Linotype</option>
                    <option value="Garamond">Garamond</option>
                    <option value="Book Antiqua">Book Antiqua</option>
                </optgroup>
                <optgroup label="Monospace (Web Safe)">
                    <option value="Courier New">Courier New</option>
                    <option value="Lucida Console">Lucida Console</option>
                    <option value="Monaco">Monaco</option>
                    <option value="Consolas">Consolas</option>
                </optgroup>
                <optgroup label="Display (Web Safe)">
                    <option value="Impact">Impact</option>
                    <option value="Comic Sans MS">Comic Sans MS</option>
                </optgroup>
                <optgroup label="Google Fonts">
                    <option value="Roboto">Roboto</option>
                    <option value="Open Sans">Open Sans</option>
                    <option value="Lato">Lato</option>
                    <option value="Montserrat">Montserrat</option>
                    <option value="Oswald">Oswald</option>
                    <option value="Raleway">Raleway</option>
                    <option value="Playfair Display">Playfair Display</option>
                    <option value="Bebas Neue">Bebas Neue</option>
                    <option value="Pacifico">Pacifico</option>
                    <option value="Dancing Script">Dancing Script</option>
                </optgroup>
            </select>
        </div>

        <div class="control-group">
            <label for="header_footer_font_size">Header Font Size (mm)</label>
            <input type="range" id="header_footer_font_size" min="3" max="20" step="0.5" value="8">
            <input type="number" id="header_footer_font_size_num" min="3" max="20" step="0.5" value="8">
        </div>

        <div class="divider"></div>

        <div class="control-group">
            <label for="footer_height">Footer Height (mm)</label>
            <input type="range" id="footer_height" min="20" max="50" step="1" value="30">
            <input type="number" id="footer_height_num" min="20" max="50" step="1" value="30">
        </div>

        <div class="control-group">
            <label for="footer_text">Footer Text</label>
            <input type="text" id="footer_text" placeholder="Enter footer text" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>

        <div class="control-group">
            <label for="font_family_footer">Footer Font</label>
            <select id="font_family_footer" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                <optgroup label="Sans-Serif (Web Safe)">
                    <option value="Arial">Arial</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Verdana">Verdana</option>
                    <option value="Tahoma">Tahoma</option>
                    <option value="Trebuchet MS">Trebuchet MS</option>
                    <option value="Century Gothic">Century Gothic</option>
                    <option value="Franklin Gothic Medium">Franklin Gothic Medium</option>
                </optgroup>
                <optgroup label="Serif (Web Safe)">
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Palatino Linotype">Palatino Linotype</option>
                    <option value="Garamond">Garamond</option>
                    <option value="Book Antiqua">Book Antiqua</option>
                </optgroup>
                <optgroup label="Monospace (Web Safe)">
                    <option value="Courier New">Courier New</option>
                    <option value="Lucida Console">Lucida Console</option>
                    <option value="Monaco">Monaco</option>
                    <option value="Consolas">Consolas</option>
                </optgroup>
                <optgroup label="Display (Web Safe)">
                    <option value="Impact">Impact</option>
                    <option value="Comic Sans MS">Comic Sans MS</option>
                </optgroup>
                <optgroup label="Google Fonts">
                    <option value="Roboto">Roboto</option>
                    <option value="Open Sans">Open Sans</option>
                    <option value="Lato">Lato</option>
                    <option value="Montserrat">Montserrat</option>
                    <option value="Oswald">Oswald</option>
                    <option value="Raleway">Raleway</option>
                    <option value="Playfair Display">Playfair Display</option>
                    <option value="Bebas Neue">Bebas Neue</option>
                    <option value="Pacifico">Pacifico</option>
                    <option value="Dancing Script">Dancing Script</option>
                </optgroup>
            </select>
        </div>

        <div class="control-group">
            <label for="footer_font_size">Footer Font Size (mm)</label>
            <input type="range" id="footer_font_size" min="3" max="20" step="0.5" value="8">
            <input type="number" id="footer_font_size_num" min="3" max="20" step="0.5" value="8">
        </div>

        <div class="divider"></div>

        <div class="control-group">
            <label for="num_slider_sections">Number of Slider Sections</label>
            <input type="range" id="num_slider_sections" min="1" max="5" step="1" value="1">
            <input type="number" id="num_slider_sections_num" min="1" max="5" step="1" value="1">
        </div>

        <div class="control-group">
            <label for="slider_height">Slider Height (mm)</label>
            <input type="range" id="slider_height" min="12" max="25" step="1" value="16">
            <input type="number" id="slider_height_num" min="12" max="25" step="1" value="16">
        </div>

        <div class="control-group">
            <label for="slot_margin">Slot Margin (mm)</label>
            <input type="range" id="slot_margin" min="3" max="15" step="0.1" value="6.35">
            <input type="number" id="slot_margin_num" min="3" max="15" step="0.1" value="6.35">
        </div>

        <div class="control-group">
            <label for="slot_height">Slot Height (mm)</label>
            <input type="range" id="slot_height" min="8" max="20" step="0.1" value="12.70">
            <input type="number" id="slot_height_num" min="8" max="20" step="0.1" value="12.70">
        </div>

        <div class="control-group">
            <label for="slider_font_size">Slider Text Font Size (mm)</label>
            <input type="range" id="slider_font_size" min="2" max="15" step="0.5" value="6">
            <input type="number" id="slider_font_size_num" min="2" max="15" step="0.5" value="6">
        </div>

        <div class="control-group">
            <label>Slider Section Labels (one per line)</label>
            <textarea id="slider_labels" rows="3" placeholder="Label 1&#10;Label 2&#10;Label 3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; resize: vertical;"></textarea>
        </div>

        <div class="control-group">
            <label for="font_family_slider_labels">Slider Labels Font</label>
            <select id="font_family_slider_labels" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                <optgroup label="Sans-Serif (Web Safe)">
                    <option value="Arial">Arial</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Verdana">Verdana</option>
                    <option value="Tahoma">Tahoma</option>
                    <option value="Trebuchet MS">Trebuchet MS</option>
                    <option value="Century Gothic">Century Gothic</option>
                    <option value="Franklin Gothic Medium">Franklin Gothic Medium</option>
                </optgroup>
                <optgroup label="Serif (Web Safe)">
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Palatino Linotype">Palatino Linotype</option>
                    <option value="Garamond">Garamond</option>
                    <option value="Book Antiqua">Book Antiqua</option>
                </optgroup>
                <optgroup label="Monospace (Web Safe)">
                    <option value="Courier New">Courier New</option>
                    <option value="Lucida Console">Lucida Console</option>
                    <option value="Monaco">Monaco</option>
                    <option value="Consolas">Consolas</option>
                </optgroup>
                <optgroup label="Display (Web Safe)">
                    <option value="Impact">Impact</option>
                    <option value="Comic Sans MS">Comic Sans MS</option>
                </optgroup>
                <optgroup label="Google Fonts">
                    <option value="Roboto">Roboto</option>
                    <option value="Open Sans">Open Sans</option>
                    <option value="Lato">Lato</option>
                    <option value="Montserrat">Montserrat</option>
                    <option value="Oswald">Oswald</option>
                    <option value="Raleway">Raleway</option>
                    <option value="Playfair Display">Playfair Display</option>
                    <option value="Bebas Neue">Bebas Neue</option>
                    <option value="Pacifico">Pacifico</option>
                    <option value="Dancing Script">Dancing Script</option>
                </optgroup>
            </select>
        </div>

        <div class="control-group">
            <label for="label_text_x_offset">Section Label X Position (mm)</label>
            <input type="range" id="label_text_x_offset" min="0" max="70" step="0.5" value="0">
            <input type="number" id="label_text_x_offset_num" min="0" max="70" step="0.5" value="0">
        </div>

        <div class="control-group">
            <label>Slider Hidden Text (one per line)</label>
            <textarea id="slider_hidden_text" rows="3" placeholder="Hidden text 1&#10;Hidden text 2&#10;Hidden text 3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; resize: vertical;"></textarea>
        </div>

        <div class="control-group">
            <label for="font_family_slider_hidden">Hidden Text Font</label>
            <select id="font_family_slider_hidden" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                <optgroup label="Sans-Serif (Web Safe)">
                    <option value="Arial">Arial</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Verdana">Verdana</option>
                    <option value="Tahoma">Tahoma</option>
                    <option value="Trebuchet MS">Trebuchet MS</option>
                    <option value="Century Gothic">Century Gothic</option>
                    <option value="Franklin Gothic Medium">Franklin Gothic Medium</option>
                </optgroup>
                <optgroup label="Serif (Web Safe)">
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Palatino Linotype">Palatino Linotype</option>
                    <option value="Garamond">Garamond</option>
                    <option value="Book Antiqua">Book Antiqua</option>
                </optgroup>
                <optgroup label="Monospace (Web Safe)">
                    <option value="Courier New">Courier New</option>
                    <option value="Lucida Console">Lucida Console</option>
                    <option value="Monaco">Monaco</option>
                    <option value="Consolas">Consolas</option>
                </optgroup>
                <optgroup label="Display (Web Safe)">
                    <option value="Impact">Impact</option>
                    <option value="Comic Sans MS">Comic Sans MS</option>
                </optgroup>
                <optgroup label="Google Fonts">
                    <option value="Roboto">Roboto</option>
                    <option value="Open Sans">Open Sans</option>
                    <option value="Lato">Lato</option>
                    <option value="Montserrat">Montserrat</option>
                    <option value="Oswald">Oswald</option>
                    <option value="Raleway">Raleway</option>
                    <option value="Playfair Display">Playfair Display</option>
                    <option value="Bebas Neue">Bebas Neue</option>
                    <option value="Pacifico">Pacifico</option>
                    <option value="Dancing Script">Dancing Script</option>
                </optgroup>
            </select>
        </div>

        <div class="control-group">
            <label for="hidden_text_offset">Hidden Text Position (%)</label>
            <input type="range" id="hidden_text_offset" min="10" max="90" step="1" value="25">
            <input type="number" id="hidden_text_offset_num" min="10" max="90" step="1" value="25">
        </div>

        <div class="control-group">
            <label>Slider Track Background Text (one per line)</label>
            <textarea id="slider_background_text" rows="3" placeholder="Background text 1&#10;Background text 2&#10;Background text 3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; resize: vertical;"></textarea>
        </div>

        <div class="control-group">
            <label for="font_family_background">Background Text Font</label>
            <select id="font_family_background" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                <optgroup label="Sans-Serif (Web Safe)">
                    <option value="Arial">Arial</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Verdana">Verdana</option>
                    <option value="Tahoma">Tahoma</option>
                    <option value="Trebuchet MS">Trebuchet MS</option>
                    <option value="Century Gothic">Century Gothic</option>
                    <option value="Franklin Gothic Medium">Franklin Gothic Medium</option>
                </optgroup>
                <optgroup label="Serif (Web Safe)">
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Palatino Linotype">Palatino Linotype</option>
                    <option value="Garamond">Garamond</option>
                    <option value="Book Antiqua">Book Antiqua</option>
                </optgroup>
                <optgroup label="Monospace (Web Safe)">
                    <option value="Courier New">Courier New</option>
                    <option value="Lucida Console">Lucida Console</option>
                    <option value="Monaco">Monaco</option>
                    <option value="Consolas">Consolas</option>
                </optgroup>
                <optgroup label="Display (Web Safe)">
                    <option value="Impact">Impact</option>
                    <option value="Comic Sans MS">Comic Sans MS</option>
                </optgroup>
                <optgroup label="Google Fonts">
                    <option value="Roboto">Roboto</option>
                    <option value="Open Sans">Open Sans</option>
                    <option value="Lato">Lato</option>
                    <option value="Montserrat">Montserrat</option>
                    <option value="Oswald">Oswald</option>
                    <option value="Raleway">Raleway</option>
                    <option value="Playfair Display">Playfair Display</option>
                    <option value="Bebas Neue">Bebas Neue</option>
                    <option value="Pacifico">Pacifico</option>
                    <option value="Dancing Script">Dancing Script</option>
                </optgroup>
            </select>
        </div>

        <div class="control-group">
            <label for="background_text_x_offset">Background Text X Position (mm)</label>
            <input type="range" id="background_text_x_offset" min="30" max="60" step="0.5" value="45">
            <input type="number" id="background_text_x_offset_num" min="30" max="60" step="0.5" value="45">
        </div>

        <div id="slider_position_controls">
            <!-- Slider position controls will be dynamically added here -->
        </div>

        <div class="divider"></div>

        <div class="export-section">
            <h2>‚öôÔ∏è Settings Management</h2>
            <div class="export-buttons">
                <button onclick="saveConfiguration()" style="grid-column: 1 / -1; background: #9C27B0;">üíæ Save Configuration</button>
                <button onclick="loadConfiguration()" style="grid-column: 1 / -1; background: #9C27B0;">üìÇ Load Configuration</button>
                <button onclick="setAsDefault()" style="grid-column: 1 / -1; background: #607D8B;">‚≠ê Set as My Default</button>
                <button onclick="resetToDefaults()" style="grid-column: 1 / -1; background: #795548;">üîÑ Reset to Factory Defaults</button>
            </div>
            <input type="file" id="configFileInput" accept=".json" style="display: none;" onchange="handleConfigFileLoad(event)">
        </div>

        <div class="export-section">
            <h2>üì• Export Layers (SVG)</h2>
            <div class="export-buttons">
                <button onclick="exportLayer('layer1')">Layer 1</button>
                <button onclick="exportLayer('layer2')">Layer 2</button>
                <button onclick="exportLayer('layer3')">Layer 3</button>
                <button onclick="exportLayer('slider')">Slider</button>
                <button onclick="exportLayer('knob')">Knob</button>
                <button onclick="exportAllLayers()" style="grid-column: 1 / -1; background: #2196F3;">Export All (Separate Files)</button>
                <button onclick="exportAllLayersOneSVG()" style="grid-column: 1 / -1; background: #FF9800;">Export All (One File)</button>
            </div>
        </div>
    </div>
    
    <div class="viewer">
        <div id="canvas-container"></div>
        <div class="controls-hint">üñ±Ô∏è Left click + drag to rotate | Right click + drag to pan | Scroll to zoom</div>
    </div>

    <script>
        // Factory default parameters
        const FACTORY_DEFAULTS = {
            material_thickness: 3,
            board_width: 127,
            num_slider_sections: 1,
            header_height: 30,
            slider_height: 16,
            footer_height: 30,
            slot_margin: 6.35,
            slot_height: 12.70,
            layer_gap: 0.05,
            slider_clearance: 0.2,
            knob_cutout_margin: 0.5,
            knob_height_reduction: 0.5,
            knob_clearance: 0.3,
            header_text: '',
            footer_text: '',
            slider_labels: [],
            slider_hidden_text: [],
            slider_background_text: [],
            font_family_header: 'Arial',
            font_family_footer: 'Arial',
            font_family_slider_labels: 'Arial',
            font_family_slider_hidden: 'Arial',
            font_family_background: 'Arial',
            header_footer_font_size: 8,
            footer_font_size: 8,
            slider_font_size: 6,
            hidden_text_offset: 25,
            label_text_x_offset: 0,
            background_text_x_offset: 45,
            slider_positions: []  // Percentage of slider movement (-18 to 50)
        };

        // Load user defaults from localStorage or use factory defaults
        function loadUserDefaults() {
            const savedDefaults = localStorage.getItem('reminderBoardDefaults');
            if (savedDefaults) {
                try {
                    return JSON.parse(savedDefaults);
                } catch (e) {
                    console.error('Error loading user defaults:', e);
                    return { ...FACTORY_DEFAULTS };
                }
            }
            return { ...FACTORY_DEFAULTS };
        }

        // Parameters object - initialized with user defaults or factory defaults
        let params = loadUserDefaults();

        // Three.js setup
        let scene, camera, renderer, controls;
        let assemblyGroup;
        let layer1Group, layer2Group, layer3Group;

        function initThreeJS() {
            const container = document.getElementById('canvas-container');
            
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xe0e0e0);
            
            // Camera
            camera = new THREE.PerspectiveCamera(
                45,
                container.clientWidth / container.clientHeight,
                1,
                10000
            );
            camera.position.set(150, -150, 150);
            camera.lookAt(0, 0, 0);
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            
            // Controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(100, 100, 100);
            scene.add(directionalLight);

            // Handle window resize
            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
            
            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            animate();
        }

        // Helper function to create extruded shape from points
        function createExtrudedShape(points, height, color) {
            const shape = new THREE.Shape(points.map(p => new THREE.Vector2(p[0], p[1])));
            const geometry = new THREE.ExtrudeGeometry(shape, {
                depth: height,
                bevelEnabled: false
            });
            const material = new THREE.MeshStandardMaterial({ 
                color: color,
                roughness: 0.7,
                metalness: 0.1
            });
            return new THREE.Mesh(geometry, material);
        }

        // Helper to create pill shape points
        function createPillPoints(width, height, centerX, centerY) {
            const radius = height / 2;
            const points = [];
            const segments = 16;

            // Right semicircle
            for (let i = 0; i <= segments; i++) {
                const angle = (Math.PI / segments) * i - Math.PI / 2;
                points.push([
                    centerX + width - radius + Math.cos(angle) * radius,
                    centerY + Math.sin(angle) * radius
                ]);
            }

            // Left semicircle
            for (let i = 0; i <= segments; i++) {
                const angle = (Math.PI / segments) * i + Math.PI / 2;
                points.push([
                    centerX + radius + Math.cos(angle) * radius,
                    centerY + Math.sin(angle) * radius
                ]);
            }

            return points;
        }

        // Helper to create 3D text using canvas texture on a plane
        function create3DText(text, fontSize, fontFamily, color) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');

            // Set font and measure text
            context.font = `bold ${fontSize * 10}px ${fontFamily}`;
            const metrics = context.measureText(text);
            const textWidth = metrics.width;
            const textHeight = fontSize * 10;

            // Set canvas size
            canvas.width = textWidth + 20;
            canvas.height = textHeight + 20;

            // Clear canvas
            context.clearRect(0, 0, canvas.width, canvas.height);

            // Draw text outline
            context.font = `bold ${fontSize * 10}px ${fontFamily}`;
            context.strokeStyle = color;
            context.lineWidth = 3;
            context.textBaseline = 'middle';
            context.textAlign = 'center';
            context.strokeText(text, canvas.width / 2, canvas.height / 2);

            // Create texture from canvas
            const texture = new THREE.CanvasTexture(canvas);
            texture.needsUpdate = true;

            // Create plane geometry
            const geometry = new THREE.PlaneGeometry(textWidth / 10, textHeight / 10);

            // Create material with texture
            const material = new THREE.MeshBasicMaterial({
                map: texture,
                transparent: true,
                side: THREE.DoubleSide,
                depthWrite: false
            });

            // Create mesh
            const mesh = new THREE.Mesh(geometry, material);

            return mesh;
        }

        // Helper to create rectangle with hole (pill)
        function createRectangleWithPillHole(rectWidth, rectHeight, holeWidth, holeHeight, holeX, holeY) {
            const outerPoints = [
                [0, 0],
                [rectWidth, 0],
                [rectWidth, rectHeight],
                [0, rectHeight]
            ].map(p => new THREE.Vector2(p[0], p[1]));
            
            const shape = new THREE.Shape(outerPoints);
            
            // Create hole
            const holeRadius = holeHeight / 2;
            const holePath = new THREE.Path();
            const holePoints = createPillPoints(holeWidth, holeHeight, holeX, holeY);
            holePath.moveTo(holePoints[0][0], holePoints[0][1]);
            for (let i = 1; i < holePoints.length; i++) {
                holePath.lineTo(holePoints[i][0], holePoints[i][1]);
            }
            holePath.closePath();
            shape.holes.push(holePath);
            
            return shape;
        }

        // Function to update slider position controls based on num_slider_sections
        function updateSliderPositionControls() {
            const container = document.getElementById('slider_position_controls');
            container.innerHTML = '';

            // Ensure slider_positions array has correct length
            while (params.slider_positions.length < params.num_slider_sections) {
                params.slider_positions.push(0);
            }
            params.slider_positions = params.slider_positions.slice(0, params.num_slider_sections);

            // Create controls for each slider
            for (let i = 0; i < params.num_slider_sections; i++) {
                const controlGroup = document.createElement('div');
                controlGroup.className = 'control-group';

                const label = document.createElement('label');
                label.textContent = `Slider ${i + 1} Position (%)`;
                label.setAttribute('for', `slider_position_${i}`);

                const rangeInput = document.createElement('input');
                rangeInput.type = 'range';
                rangeInput.id = `slider_position_${i}`;
                rangeInput.min = '-18';
                rangeInput.max = '50';
                rangeInput.step = '1';
                rangeInput.value = params.slider_positions[i] || 0;
                rangeInput.style.width = '100%';
                rangeInput.style.marginBottom = '5px';

                const numberInput = document.createElement('input');
                numberInput.type = 'number';
                numberInput.id = `slider_position_${i}_num`;
                numberInput.min = '-18';
                numberInput.max = '50';
                numberInput.step = '1';
                numberInput.value = params.slider_positions[i] || 0;
                numberInput.style.width = '100%';
                numberInput.style.padding = '8px';
                numberInput.style.border = '1px solid #ddd';
                numberInput.style.borderRadius = '4px';
                numberInput.style.fontSize = '14px';

                // Add event listeners
                rangeInput.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    numberInput.value = value;
                    params.slider_positions[i] = value;
                    updateModel();
                });

                numberInput.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    rangeInput.value = value;
                    params.slider_positions[i] = value;
                    updateModel();
                });

                controlGroup.appendChild(label);
                controlGroup.appendChild(rangeInput);
                controlGroup.appendChild(numberInput);
                container.appendChild(controlGroup);
            }
        }

        function updateModel() {
            // Remove old assembly
            if (assemblyGroup) {
                scene.remove(assemblyGroup);
            }

            assemblyGroup = new THREE.Group();

            const totalHeight = params.header_height + (params.slider_height * params.num_slider_sections) + params.footer_height;

            // Layer 1 - Solid base
            layer1Group = new THREE.Group();
            const layer1Points = [
                [0, 0],
                [params.board_width, 0],
                [params.board_width, totalHeight],
                [0, totalHeight]
            ];
            const layer1 = createExtrudedShape(layer1Points, params.material_thickness, 0xD2B48C);
            layer1Group.add(layer1);

            // Add background text on Layer 1 in slider track areas
            for (let i = 0; i < params.num_slider_sections; i++) {
                if (params.slider_background_text[i]) {
                    const backgroundTextMesh = create3DText(params.slider_background_text[i], params.slider_font_size, params.font_family_background, '#000000');
                    backgroundTextMesh.position.set(
                        params.board_width / 2 + params.background_text_x_offset,
                        params.footer_height + (i * params.slider_height) + (params.slider_height / 2),
                        params.material_thickness + 0.1
                    );
                    layer1Group.add(backgroundTextMesh);
                }
            }
            assemblyGroup.add(layer1Group);
            
            // Layer 2 - With pill slots
            const slot_width = params.board_width - (2 * params.slot_margin);
            const slot_radius = params.slot_height / 2;

            layer2Group = new THREE.Group();
            const layer2Shapes = [];
            // Header
            layer2Shapes.push(createExtrudedShape([
                [0, params.footer_height + (params.slider_height * params.num_slider_sections)],
                [params.board_width, params.footer_height + (params.slider_height * params.num_slider_sections)],
                [params.board_width, totalHeight],
                [0, totalHeight]
            ], params.material_thickness, 0xD2B48C));

            // Slider sections with holes
            for (let i = 0; i < params.num_slider_sections; i++) {
                const sectionY = params.footer_height + (i * params.slider_height);
                const slotY = sectionY + (params.slider_height - params.slot_height) / 2 + slot_radius;

                const shape = createRectangleWithPillHole(
                    params.board_width,
                    params.slider_height,
                    slot_width,
                    params.slot_height,
                    params.slot_margin,
                    (params.slider_height - params.slot_height) / 2 + slot_radius
                );

                const geometry = new THREE.ExtrudeGeometry(shape, {
                    depth: params.material_thickness,
                    bevelEnabled: false
                });
                const material = new THREE.MeshStandardMaterial({
                    color: 0xD2B48C,
                    roughness: 0.7,
                    metalness: 0.1
                });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.y = sectionY;
                layer2Shapes.push(mesh);
            }

            // Footer
            layer2Shapes.push(createExtrudedShape([
                [0, 0],
                [params.board_width, 0],
                [params.board_width, params.footer_height],
                [0, params.footer_height]
            ], params.material_thickness, 0xD2B48C));

            layer2Shapes.forEach(shape => layer2Group.add(shape));
            layer2Group.position.z = params.material_thickness + params.layer_gap;
            assemblyGroup.add(layer2Group);
            
            // Layer 3 - With knob cutouts
            const slider_piece_height = params.slot_height - params.slider_clearance;
            const knob_cutout_width = params.board_width / 3.5;
            const knob_cutout_height = slider_piece_height - (2 * params.knob_height_reduction);

            layer3Group = new THREE.Group();
            const layer3Shapes = [];
            // Header
            layer3Shapes.push(createExtrudedShape([
                [0, params.footer_height + (params.slider_height * params.num_slider_sections)],
                [params.board_width, params.footer_height + (params.slider_height * params.num_slider_sections)],
                [params.board_width, totalHeight],
                [0, totalHeight]
            ], params.material_thickness, 0xD2B48C));

            // Slider sections with knob holes
            for (let i = 0; i < params.num_slider_sections; i++) {
                const sectionY = params.footer_height + (i * params.slider_height);
                const knob_x_offset = params.board_width - params.slot_margin - params.knob_cutout_margin - knob_cutout_width;
                const knob_y_offset = (params.slider_height - knob_cutout_height) / 2 + knob_cutout_height / 2;

                const shape = createRectangleWithPillHole(
                    params.board_width,
                    params.slider_height,
                    knob_cutout_width,
                    knob_cutout_height,
                    knob_x_offset,
                    knob_y_offset
                );

                const geometry = new THREE.ExtrudeGeometry(shape, {
                    depth: params.material_thickness,
                    bevelEnabled: false
                });
                const material = new THREE.MeshStandardMaterial({
                    color: 0xD2B48C,
                    roughness: 0.7,
                    metalness: 0.1
                });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.y = sectionY;
                layer3Shapes.push(mesh);
            }

            // Footer
            layer3Shapes.push(createExtrudedShape([
                [0, 0],
                [params.board_width, 0],
                [params.board_width, params.footer_height],
                [0, params.footer_height]
            ], params.material_thickness, 0xD2B48C));

            layer3Shapes.forEach(shape => layer3Group.add(shape));
            layer3Group.position.z = (2 * params.material_thickness) + (2 * params.layer_gap);

            // Add footer text to Layer 3 (at bottom)
            if (params.footer_text) {
                const footerTextMesh = create3DText(params.footer_text, params.footer_font_size, params.font_family_footer, '#000000');
                // No rotation needed - plane is already flat in XY
                footerTextMesh.position.set(
                    params.board_width / 2,
                    params.footer_height / 2,
                    params.material_thickness + 0.1
                );
                layer3Group.add(footerTextMesh);
            }

            // Add header text to Layer 3 (at top)
            if (params.header_text) {
                const headerTextMesh = create3DText(params.header_text, params.header_footer_font_size, params.font_family_header, '#000000');
                // No rotation needed - plane is already flat in XY
                headerTextMesh.position.set(
                    params.board_width / 2,
                    totalHeight - params.header_height / 2,
                    params.material_thickness + 0.1
                );
                layer3Group.add(headerTextMesh);
            }

            // Add slider section labels to Layer 3
            for (let i = 0; i < params.num_slider_sections; i++) {
                if (params.slider_labels[i]) {
                    const labelMesh = create3DText(params.slider_labels[i], params.slider_font_size, params.font_family_slider_labels, '#000000');
                    // No rotation needed - plane is already flat in XY
                    labelMesh.position.set(
                        params.slot_margin / 2 + params.label_text_x_offset,
                        params.footer_height + (i * params.slider_height) + (params.slider_height / 2),
                        params.material_thickness + 0.1
                    );
                    layer3Group.add(labelMesh);
                }
            }

            assemblyGroup.add(layer3Group);
            
            // Sliders
            const slider_radius = slider_piece_height / 2;
            const slider_length = slot_width - (params.board_width / 3.5);

            for (let i = 0; i < params.num_slider_sections; i++) {
                // Calculate max travel distance for slider
                const max_travel = slot_width - slider_length;

                // Get slider position (0-100%) and convert to actual X offset
                const slider_position_percent = params.slider_positions[i] || 0;
                const slider_travel = max_travel * (slider_position_percent / 100);

                const slider_x_offset = params.slot_margin + (slot_width - slider_length) / 2 + slider_travel;
                const slider_y_offset = params.footer_height + (i * params.slider_height) + (params.slider_height - slider_piece_height) / 2 + slider_radius;

                const sliderPoints = createPillPoints(slider_length, slider_piece_height, 0, 0);
                const slider = createExtrudedShape(sliderPoints, params.material_thickness, 0xCD853F);
                slider.position.set(slider_x_offset, slider_y_offset, params.material_thickness);
                assemblyGroup.add(slider);

                // Add hidden text to slider
                if (params.slider_hidden_text[i]) {
                    const hiddenTextMesh = create3DText(params.slider_hidden_text[i], params.slider_font_size, params.font_family_slider_hidden, '#000000');
                    // No rotation needed - plane is already flat in XY
                    hiddenTextMesh.position.set(
                        slider_x_offset + slider_length * (params.hidden_text_offset / 100),
                        slider_y_offset,
                        params.material_thickness + params.material_thickness + 0.1
                    );
                    assemblyGroup.add(hiddenTextMesh);
                }

                // Knob
                const knob_diameter = knob_cutout_height - params.knob_clearance;
                const knob_radius = knob_diameter / 2;
                const knob_x_offset = slider_x_offset + slider_length - slider_radius;
                const knob_y_offset = params.footer_height + (i * params.slider_height) + (params.slider_height / 2);

                const knobGeometry = new THREE.CylinderGeometry(knob_radius, knob_radius, params.material_thickness, 32);
                knobGeometry.rotateX(Math.PI / 2);
                const knobMaterial = new THREE.MeshStandardMaterial({
                    color: 0x8B4513,
                    roughness: 0.6,
                    metalness: 0.2
                });
                const knob = new THREE.Mesh(knobGeometry, knobMaterial);
                knob.position.set(knob_x_offset, knob_y_offset, (2 * params.material_thickness) + (2 * params.layer_gap) + params.material_thickness / 2);
                assemblyGroup.add(knob);
            }
            
            // Center the assembly
            assemblyGroup.position.set(-params.board_width / 2, -totalHeight / 2, 0);
            scene.add(assemblyGroup);

            // Apply layer visibility settings
            updateLayerVisibility();
        }

        function updateLayerVisibility() {
            if (layer1Group) {
                layer1Group.visible = document.getElementById('show_layer1').checked;
            }
            if (layer2Group) {
                layer2Group.visible = document.getElementById('show_layer2').checked;
            }
            if (layer3Group) {
                layer3Group.visible = document.getElementById('show_layer3').checked;
            }
        }

        // SVG Export functions
        function createSVGPath(points, close = true) {
            let path = `M ${points[0][0]} ${points[0][1]}`;
            for (let i = 1; i < points.length; i++) {
                path += ` L ${points[i][0]} ${points[i][1]}`;
            }
            if (close) path += ' Z';
            return path;
        }

        function createSVGText(text, x, y, fontSize, fontFamily, anchor = 'middle') {
            if (!text) return '';
            const escapedText = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return `<text x="${x}" y="${y}" font-family="${fontFamily}" font-size="${fontSize}" text-anchor="${anchor}" fill="none" stroke="black" stroke-width="0.1">${escapedText}</text>`;
        }

        function exportLayer(layerType) {
            const totalHeight = params.header_height + (params.slider_height * params.num_slider_sections) + params.footer_height;
            const slot_width = params.board_width - (2 * params.slot_margin);
            const slider_piece_height = params.slot_height - params.slider_clearance;
            const slider_radius = slider_piece_height / 2;
            const slider_length = slot_width - (params.board_width / 3.5);
            const knob_cutout_width = params.board_width / 3.5;
            const knob_cutout_height = slider_piece_height - (2 * params.knob_height_reduction);
            const knob_diameter = knob_cutout_height - params.knob_clearance;
            
            let svgContent = `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="${params.board_width}mm" height="${totalHeight}mm" viewBox="0 0 ${params.board_width} ${totalHeight}">`;
            
            if (layerType === 'layer1') {
                // Simple rectangle
                svgContent += `<rect x="0" y="0" width="${params.board_width}" height="${totalHeight}" fill="none" stroke="black" stroke-width="0.1"/>`;

                // Add background text in slider track areas
                for (let i = 0; i < params.num_slider_sections; i++) {
                    if (params.slider_background_text[i]) {
                        const textX = params.board_width / 2 + params.background_text_x_offset;
                        const textY = params.footer_height + (i * params.slider_height) + (params.slider_height / 2) + params.slider_font_size / 3;
                        svgContent += createSVGText(params.slider_background_text[i], textX, textY, params.slider_font_size, params.font_family_background, 'middle');
                    }
                }

            } else if (layerType === 'layer2') {
                // Outer rectangle
                svgContent += `<rect x="0" y="0" width="${params.board_width}" height="${totalHeight}" fill="none" stroke="black" stroke-width="0.1"/>`;

                // Pill slots
                for (let i = 0; i < params.num_slider_sections; i++) {
                    const slot_y_offset = params.footer_height + (i * params.slider_height) + (params.slider_height - params.slot_height) / 2;
                    const slot_radius = params.slot_height / 2;
                    const slotPoints = createPillPoints(slot_width, params.slot_height, params.slot_margin, slot_y_offset + slot_radius);
                    svgContent += `<path d="${createSVGPath(slotPoints)}" fill="none" stroke="black" stroke-width="0.1"/>`;
                }

            } else if (layerType === 'layer3') {
                // Outer rectangle
                svgContent += `<rect x="0" y="0" width="${params.board_width}" height="${totalHeight}" fill="none" stroke="black" stroke-width="0.1"/>`;

                // Knob cutouts
                for (let i = 0; i < params.num_slider_sections; i++) {
                    const knob_x_offset = params.board_width - params.slot_margin - params.knob_cutout_margin - knob_cutout_width;
                    const knob_y_offset = params.footer_height + (i * params.slider_height) + (params.slider_height - knob_cutout_height) / 2;
                    const knob_cutout_radius = knob_cutout_height / 2;
                    const cutoutPoints = createPillPoints(knob_cutout_width, knob_cutout_height, knob_x_offset, knob_y_offset + knob_cutout_radius);
                    svgContent += `<path d="${createSVGPath(cutoutPoints)}" fill="none" stroke="black" stroke-width="0.1"/>`;
                }

                // Add slider section labels (to the left of the opening)
                for (let i = 0; i < params.num_slider_sections; i++) {
                    if (params.slider_labels[i]) {
                        const labelX = params.slot_margin / 2 + params.label_text_x_offset;
                        const labelY = params.footer_height + (i * params.slider_height) + (params.slider_height / 2) + params.slider_font_size / 3;
                        svgContent += createSVGText(params.slider_labels[i], labelX, labelY, params.slider_font_size, params.font_family_slider_labels, 'start');
                    }
                }

                // Add footer text (at bottom)
                if (params.footer_text) {
                    const footerY = params.footer_height / 2 + params.footer_font_size / 3;
                    svgContent += createSVGText(params.footer_text, params.board_width / 2, footerY, params.footer_font_size, params.font_family_footer);
                }

                // Add header text (at top)
                if (params.header_text) {
                    const headerY = totalHeight - params.header_height / 2 + params.header_footer_font_size / 3;
                    svgContent += createSVGText(params.header_text, params.board_width / 2, headerY, params.header_footer_font_size, params.font_family_header);
                }

            } else if (layerType === 'slider') {
                const sliderHeight = slider_piece_height;
                for (let i = 0; i < params.num_slider_sections; i++) {
                    const yOffset = i * (sliderHeight + 5);
                    const sliderPoints = createPillPoints(slider_length, sliderHeight, 0, yOffset + slider_radius);
                    svgContent += `<path d="${createSVGPath(sliderPoints)}" fill="none" stroke="black" stroke-width="0.1"/>`;

                    // Add hidden text that shows when slider is moved right
                    if (params.slider_hidden_text[i]) {
                        const textX = slider_length * (params.hidden_text_offset / 100);
                        const textY = yOffset + slider_radius + params.slider_font_size / 3;
                        svgContent += createSVGText(params.slider_hidden_text[i], textX, textY, params.slider_font_size, params.font_family_slider_hidden, 'middle');
                    }
                }

            } else if (layerType === 'knob') {
                const knob_radius = knob_diameter / 2;
                for (let i = 0; i < params.num_slider_sections; i++) {
                    const xOffset = i * (knob_diameter + 5) + knob_radius;
                    svgContent += `<circle cx="${xOffset}" cy="${knob_radius}" r="${knob_radius}" fill="none" stroke="black" stroke-width="0.1"/>`;
                }
            }
            
            svgContent += '</svg>';
            
            // Download
            const blob = new Blob([svgContent], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `reminder_board_${layerType}.svg`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function exportAllLayers() {
            const layers = ['layer1', 'layer2', 'layer3', 'slider', 'knob'];
            layers.forEach((layer, index) => {
                setTimeout(() => exportLayer(layer), index * 500);
            });
        }

        function exportAllLayersOneSVG() {
            const totalHeight = params.header_height + (params.slider_height * params.num_slider_sections) + params.footer_height;
            const slot_width = params.board_width - (2 * params.slot_margin);
            const slider_piece_height = params.slot_height - params.slider_clearance;
            const slider_radius = slider_piece_height / 2;
            const slider_length = slot_width - (params.board_width / 3.5);
            const knob_cutout_width = params.board_width / 3.5;
            const knob_cutout_height = slider_piece_height - (2 * params.knob_height_reduction);
            const knob_diameter = knob_cutout_height - params.knob_clearance;
            const knob_radius = knob_diameter / 2;
            
            const spacing = 10; // mm between parts
            
            // Calculate layout positions
            let currentX = 0;
            let currentY = 0;
            let maxHeight = 0;
            
            // Layout: Stack 3 main layers vertically on left, sliders and knobs on right
            const mainLayerWidth = params.board_width;
            const mainLayersTotalHeight = (totalHeight * 3) + (spacing * 2);
            
            const slidersX = mainLayerWidth + spacing;
            const knobsX = slidersX + slider_length + spacing;
            
            // Calculate canvas size
            const canvasWidth = knobsX + (knob_diameter * params.num_slider_sections) + ((params.num_slider_sections - 1) * 5) + spacing;
            const canvasHeight = Math.max(mainLayersTotalHeight, (slider_piece_height * params.num_slider_sections) + ((params.num_slider_sections - 1) * 5));
            
            let svgContent = `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="${canvasWidth}mm" height="${canvasHeight}mm" viewBox="0 0 ${canvasWidth} ${canvasHeight}">
<g id="all-layers">`;
            
            // Layer 1
            svgContent += `\n  <!-- Layer 1 -->`;
            svgContent += `\n  <g id="layer1" transform="translate(0, 0)">`;
            svgContent += `\n    <rect x="0" y="0" width="${params.board_width}" height="${totalHeight}" fill="none" stroke="black" stroke-width="0.1"/>`;

            // Add background text in slider track areas
            for (let i = 0; i < params.num_slider_sections; i++) {
                if (params.slider_background_text[i]) {
                    const textX = params.board_width / 2 + params.background_text_x_offset;
                    const textY = params.footer_height + (i * params.slider_height) + (params.slider_height / 2) + params.slider_font_size / 3;
                    svgContent += `\n    ` + createSVGText(params.slider_background_text[i], textX, textY, params.slider_font_size, params.font_family_background, 'middle');
                }
            }

            svgContent += `\n  </g>`;
            
            // Layer 2
            const layer2Y = totalHeight + spacing;
            svgContent += `\n\n  <!-- Layer 2 -->`;
            svgContent += `\n  <g id="layer2" transform="translate(0, ${layer2Y})">`;
            svgContent += `\n    <rect x="0" y="0" width="${params.board_width}" height="${totalHeight}" fill="none" stroke="black" stroke-width="0.1"/>`;

            // Pill slots
            for (let i = 0; i < params.num_slider_sections; i++) {
                const slot_y_offset = params.footer_height + (i * params.slider_height) + (params.slider_height - params.slot_height) / 2;
                const slot_radius = params.slot_height / 2;
                const slotPoints = createPillPoints(slot_width, params.slot_height, params.slot_margin, slot_y_offset + slot_radius);
                svgContent += `\n    <path d="${createSVGPath(slotPoints)}" fill="none" stroke="black" stroke-width="0.1"/>`;
            }
            svgContent += `\n  </g>`;
            
            // Layer 3
            const layer3Y = (totalHeight * 2) + (spacing * 2);
            svgContent += `\n\n  <!-- Layer 3 -->`;
            svgContent += `\n  <g id="layer3" transform="translate(0, ${layer3Y})">`;
            svgContent += `\n    <rect x="0" y="0" width="${params.board_width}" height="${totalHeight}" fill="none" stroke="black" stroke-width="0.1"/>`;

            // Knob cutouts
            for (let i = 0; i < params.num_slider_sections; i++) {
                const knob_x_offset = params.board_width - params.slot_margin - params.knob_cutout_margin - knob_cutout_width;
                const knob_y_offset = params.footer_height + (i * params.slider_height) + (params.slider_height - knob_cutout_height) / 2;
                const knob_cutout_radius = knob_cutout_height / 2;
                const cutoutPoints = createPillPoints(knob_cutout_width, knob_cutout_height, knob_x_offset, knob_y_offset + knob_cutout_radius);
                svgContent += `\n    <path d="${createSVGPath(cutoutPoints)}" fill="none" stroke="black" stroke-width="0.1"/>`;
            }

            // Add slider section labels
            for (let i = 0; i < params.num_slider_sections; i++) {
                if (params.slider_labels[i]) {
                    const labelX = params.slot_margin / 2 + params.label_text_x_offset;
                    const labelY = params.footer_height + (i * params.slider_height) + (params.slider_height / 2) + params.slider_font_size / 3;
                    svgContent += `\n    ` + createSVGText(params.slider_labels[i], labelX, labelY, params.slider_font_size, params.font_family_slider_labels, 'start');
                }
            }

            // Add footer text (at bottom)
            if (params.footer_text) {
                const footerY = params.footer_height / 2 + params.footer_font_size / 3;
                svgContent += `\n    ` + createSVGText(params.footer_text, params.board_width / 2, footerY, params.footer_font_size, params.font_family_footer);
            }

            // Add header text (at top)
            if (params.header_text) {
                const headerY = totalHeight - params.header_height / 2 + params.header_footer_font_size / 3;
                svgContent += `\n    ` + createSVGText(params.header_text, params.board_width / 2, headerY, params.header_footer_font_size, params.font_family_header);
            }

            svgContent += `\n  </g>`;
            
            // Sliders
            svgContent += `\n\n  <!-- Sliders -->`;
            svgContent += `\n  <g id="sliders" transform="translate(${slidersX}, 0)">`;
            for (let i = 0; i < params.num_slider_sections; i++) {
                const yOffset = i * (slider_piece_height + 5);
                const sliderPoints = createPillPoints(slider_length, slider_piece_height, 0, yOffset + slider_radius);
                svgContent += `\n    <path d="${createSVGPath(sliderPoints)}" fill="none" stroke="black" stroke-width="0.1"/>`;

                // Add hidden text
                if (params.slider_hidden_text[i]) {
                    const textX = slider_length * (params.hidden_text_offset / 100);
                    const textY = yOffset + slider_radius + params.slider_font_size / 3;
                    svgContent += `\n    ` + createSVGText(params.slider_hidden_text[i], textX, textY, params.slider_font_size, params.font_family_slider_hidden, 'middle');
                }
            }
            svgContent += `\n  </g>`;
            
            // Knobs
            svgContent += `\n\n  <!-- Knobs -->`;
            svgContent += `\n  <g id="knobs" transform="translate(${knobsX}, 0)">`;
            for (let i = 0; i < params.num_slider_sections; i++) {
                const xOffset = i * (knob_diameter + 5) + knob_radius;
                svgContent += `\n    <circle cx="${xOffset}" cy="${knob_radius}" r="${knob_radius}" fill="none" stroke="black" stroke-width="0.1"/>`;
            }
            svgContent += `\n  </g>`;
            
            svgContent += '\n</g>\n</svg>';
            
            // Download
            const blob = new Blob([svgContent], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `reminder_board_all_layers.svg`;
            link.click();
            URL.revokeObjectURL(url);
        }

        // Sync range and number inputs
        const controlNames = [
            'material_thickness', 'board_width', 'num_slider_sections',
            'header_height', 'slider_height', 'footer_height',
            'slot_margin', 'slot_height', 'header_footer_font_size', 'footer_font_size', 'slider_font_size', 'hidden_text_offset',
            'label_text_x_offset', 'background_text_x_offset'
        ];

        controlNames.forEach(name => {
            const rangeInput = document.getElementById(name);
            const numberInput = document.getElementById(name + '_num');

            rangeInput.addEventListener('input', (e) => {
                numberInput.value = e.target.value;
                params[name] = parseFloat(e.target.value);
                if (name === 'num_slider_sections') {
                    updateSliderPositionControls();
                }
                updateModel();
            });

            numberInput.addEventListener('input', (e) => {
                rangeInput.value = e.target.value;
                params[name] = parseFloat(e.target.value);
                if (name === 'num_slider_sections') {
                    updateSliderPositionControls();
                }
                updateModel();
            });
        });

        // Text input listeners
        document.getElementById('header_text').addEventListener('input', (e) => {
            params.header_text = e.target.value;
            updateModel();
        });

        document.getElementById('footer_text').addEventListener('input', (e) => {
            params.footer_text = e.target.value;
            updateModel();
        });

        document.getElementById('slider_labels').addEventListener('input', (e) => {
            params.slider_labels = e.target.value.split('\n').filter(line => line.trim() !== '');
            updateModel();
        });

        document.getElementById('slider_hidden_text').addEventListener('input', (e) => {
            params.slider_hidden_text = e.target.value.split('\n').filter(line => line.trim() !== '');
            updateModel();
        });

        document.getElementById('slider_background_text').addEventListener('input', (e) => {
            params.slider_background_text = e.target.value.split('\n').filter(line => line.trim() !== '');
            updateModel();
        });

        // Font family listeners
        document.getElementById('font_family_header').addEventListener('change', (e) => {
            params.font_family_header = e.target.value;
            updateModel();
        });

        document.getElementById('font_family_footer').addEventListener('change', (e) => {
            params.font_family_footer = e.target.value;
            updateModel();
        });

        document.getElementById('font_family_slider_labels').addEventListener('change', (e) => {
            params.font_family_slider_labels = e.target.value;
            updateModel();
        });

        document.getElementById('font_family_slider_hidden').addEventListener('change', (e) => {
            params.font_family_slider_hidden = e.target.value;
            updateModel();
        });

        document.getElementById('font_family_background').addEventListener('change', (e) => {
            params.font_family_background = e.target.value;
            updateModel();
        });

        // Layer visibility checkbox listeners
        document.getElementById('show_layer1').addEventListener('change', updateLayerVisibility);
        document.getElementById('show_layer2').addEventListener('change', updateLayerVisibility);
        document.getElementById('show_layer3').addEventListener('change', updateLayerVisibility);

        // Settings Management Functions

        // Save current configuration to JSON file
        function saveConfiguration() {
            const config = {
                version: '1.0',
                timestamp: new Date().toISOString(),
                params: params
            };

            const jsonString = JSON.stringify(config, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;

            const dateStr = new Date().toISOString().split('T')[0];
            link.download = `reminder_board_config_${dateStr}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        // Load configuration from file
        function loadConfiguration() {
            document.getElementById('configFileInput').click();
        }

        // Handle file load
        function handleConfigFileLoad(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const config = JSON.parse(e.target.result);

                    // Validate config
                    if (!config.params) {
                        alert('Invalid configuration file format.');
                        return;
                    }

                    // Update params
                    Object.assign(params, config.params);

                    // Update UI controls
                    updateUIFromParams();

                    // Update slider position controls
                    updateSliderPositionControls();

                    // Update 3D model
                    updateModel();

                    alert('Configuration loaded successfully!');
                } catch (error) {
                    alert('Error loading configuration file: ' + error.message);
                }
            };
            reader.readAsText(file);

            // Reset file input
            event.target.value = '';
        }

        // Set current configuration as user default
        function setAsDefault() {
            try {
                localStorage.setItem('reminderBoardDefaults', JSON.stringify(params));
                alert('Current settings saved as your default! These will be loaded next time you open the designer.');
            } catch (error) {
                alert('Error saving defaults: ' + error.message);
            }
        }

        // Reset to factory defaults
        function resetToDefaults() {
            if (confirm('Are you sure you want to reset all settings to factory defaults? This will not affect your saved default settings.')) {
                // Reset params to factory defaults
                Object.assign(params, FACTORY_DEFAULTS);

                // Update UI controls
                updateUIFromParams();

                // Update slider position controls
                updateSliderPositionControls();

                // Update 3D model
                updateModel();
            }
        }

        // Update all UI controls from params object
        function updateUIFromParams() {
            // Update range and number inputs
            const controlNames = [
                'material_thickness', 'board_width', 'num_slider_sections',
                'header_height', 'slider_height', 'footer_height',
                'slot_margin', 'slot_height', 'header_footer_font_size', 'footer_font_size',
                'slider_font_size', 'hidden_text_offset', 'label_text_x_offset', 'background_text_x_offset'
            ];

            controlNames.forEach(name => {
                const rangeInput = document.getElementById(name);
                const numberInput = document.getElementById(name + '_num');
                if (rangeInput && numberInput && params[name] !== undefined) {
                    rangeInput.value = params[name];
                    numberInput.value = params[name];
                }
            });

            // Update text inputs
            if (document.getElementById('header_text')) {
                document.getElementById('header_text').value = params.header_text || '';
            }
            if (document.getElementById('footer_text')) {
                document.getElementById('footer_text').value = params.footer_text || '';
            }

            // Update textareas
            if (document.getElementById('slider_labels')) {
                document.getElementById('slider_labels').value = (params.slider_labels || []).join('\n');
            }
            if (document.getElementById('slider_hidden_text')) {
                document.getElementById('slider_hidden_text').value = (params.slider_hidden_text || []).join('\n');
            }
            if (document.getElementById('slider_background_text')) {
                document.getElementById('slider_background_text').value = (params.slider_background_text || []).join('\n');
            }

            // Update font families
            if (document.getElementById('font_family_header')) {
                document.getElementById('font_family_header').value = params.font_family_header || 'Arial';
            }
            if (document.getElementById('font_family_footer')) {
                document.getElementById('font_family_footer').value = params.font_family_footer || 'Arial';
            }
            if (document.getElementById('font_family_slider_labels')) {
                document.getElementById('font_family_slider_labels').value = params.font_family_slider_labels || 'Arial';
            }
            if (document.getElementById('font_family_slider_hidden')) {
                document.getElementById('font_family_slider_hidden').value = params.font_family_slider_hidden || 'Arial';
            }
            if (document.getElementById('font_family_background')) {
                document.getElementById('font_family_background').value = params.font_family_background || 'Arial';
            }
        }

        // Initialize
        initThreeJS();
        updateSliderPositionControls();
        updateUIFromParams(); // Initialize UI from loaded defaults
        updateModel();
    </script>
</body>
</html>
